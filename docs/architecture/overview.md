<- [Содержание](../../README.md)

---

# Архитектура: обзор

Документ описывает общую структуру сервиса, входные точки и основные потоки данных.

## Входные точки

1) **HTTP API** (`src/main.ts`)
- Поднимает NestJS приложение.
- Подключает глобальные пайпы, фильтры и интерсепторы.
- Публикует Swagger UI на `/docs`.

2) **CLI импорт адресов** (`src/cli/addresses-import.main.ts`)
- Создаёт изолированный Nest-контекст без HTTP-сервера.
- Запускает импорт данных в PostgreSQL.

## Основные потоки

**Поиск адресов**
- Контроллер принимает запрос `/addresses/search`.
- Сервис нормализует параметры и формирует условия поиска.
- Репозиторий выполняет запрос через TypeORM.
- Результат преобразуется в API-структуру.

**Импорт адресов**
- CLI скачивает архив с внешнего источника.
- Данные парсятся и вставляются батчами в теневую таблицу.
- После успешной загрузки таблицы переключаются атомарно.

## Слои и директории

- `src/modules/*` — доменные модули (контроллеры, сервисы, репозитории).
- `src/infrastructure/*` — инфраструктура (БД, логирование).
- `src/common/*` — общие утилиты, интерсепторы, фильтры.
- `src/cli/*` — CLI сценарии (импорт адресов).
- `src/config/*` — конфигурация и валидация окружения.

## Полезные ссылки

- [Архитектура: карта модулей](module-map.md)
- [Архитектура: жизненный цикл запроса](request-lifecycle.md)
- [Данные: импорт адресов](../data/addresses-import.md)
