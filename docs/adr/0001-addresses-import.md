<- [ADR](README.md)

---

# ADR-0001: Импорт адресов со слепками и pg_trgm
Owner: Architecture Team
Last reviewed: 2026-02-04
Status: Accepted
Date: 2026-02-04

## Контекст
Сервис работает с большим объёмом адресных данных и должен обновлять их без простоя API. Также требуется быстрый поиск по строке на корейском и английском языках.

## Решение
Реализовать отдельный CLI-импорт, который:
1. Загружает архив адресных данных из внешнего источника.
2. Записывает данные в теневую таблицу `addresses_next`.
3. Создаёт GIN индексы `pg_trgm` по `search_ko` и `search_en`.
4. Атомарно переключает слепок (`addresses_next` -> `addresses`).

Поиск адресов выполняется в PostgreSQL с использованием `pg_trgm`.

## Последствия
- Требуются права на `CREATE EXTENSION pg_trgm`.
- Храним три таблицы слепков (`addresses`, `addresses_next`, `addresses_prev`), что увеличивает объём данных.
- Импорт — отдельный процесс, который нужно запускать по расписанию.

## Альтернативы
- Полная остановка сервиса на время загрузки (отклонено из-за простоя).
- Использование внешнего search-движка (отклонено из-за усложнения инфраструктуры на текущем этапе).
