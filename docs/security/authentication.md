<- [Содержание](../../README.md)

---

# Безопасность: аутентификация

Документ фиксирует текущий статус аутентификации и места, где её нужно добавить при появлении требований.

## Текущее состояние

- Реализованы эндпоинты `/auth/*` (email + OTP, refresh, logout, `/auth/me`).
- Access-токены (`Bearer`) используются для авторизации `/auth/me`.
- Refresh-токены хранятся как хэш в `auth_session`.
- Доменные таблицы и сервисы для identity/OTP/сессий добавлены.
- Все остальные эндпоинты публичны и не требуют токена.
- В non-production OTP возвращается в ответе и логируется, если SMTP не настроен.
- В production требуется настроенный SMTP (`MAILER_*`), иначе OTP не будет отправлен.

**Заголовок для access-токена:**

```
Authorization: Bearer <access_token>
```

## Точки расширения

Если потребуется защищать остальные эндпоинты, рекомендуемые точки интеграции:

- Глобальный Guard (`app.useGlobalGuards`) или Guard на контроллерах.
- Стратегии через `@nestjs/passport` (JWT, API Key и т.д.).
- Контекст пользователя в `Request` и логирование `request-id`.

После добавления аутентификации обновите:

- [API: обзор](../api/overview.md)
- [Безопасность: авторизация/RBAC](authorization-rbac.md)
- [Траблшутинг: частые проблемы](../troubleshooting/common-issues.md)
