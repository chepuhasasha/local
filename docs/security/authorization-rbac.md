<- [Содержание](../../README.md)

---

# Безопасность: авторизация и RBAC

Документ описывает текущий статус авторизации и возможные точки расширения.

## Текущее состояние

- Авторизация и RBAC **не реализованы**.
- Нет ролей, прав доступа и проверок на уровне контроллеров/сервисов.

## Текущие границы доступа

- Единственный защищённый эндпоинт — `GET /auth/me`.
- Защита реализована через `AccessTokenGuard` (JWT + проверка сессии).
- Все остальные эндпоинты сейчас публичны.

## Как подключать защиту

Используйте `AccessTokenGuard` на уровне контроллера или метода и извлекайте пользователя через `CurrentUser`.

Пример:

```ts
@UseGuards(AccessTokenGuard)
@Get('profile')
getProfile(@CurrentUser() user: AuthenticatedUser) {
  return this.usersService.getById(user.userId);
}
```

Что делает Guard:

- Проверяет `Authorization: Bearer <access_token>`.
- Валидирует JWT и сессию.
- Кладёт `{ userId, sessionId }` в `request.auth`.

## Точки расширения

Если потребуется контроль доступа:

- Добавьте роли и права в доменную модель.
- Реализуйте Guard или Policy layer.
- Определите матрицу прав доступа и отразите её в API-документации.

После внедрения RBAC обновите:

- [API: эндпоинты](../api/endpoints.md)
- [Безопасность: hardening](hardening.md)
