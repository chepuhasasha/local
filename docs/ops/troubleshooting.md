<- [Содержание](../README.md)

---

# Траблшутинг: частые проблемы
Owner: Ops Team
Last reviewed: 2026-02-04

## Цель
Помочь диагностировать типовые ошибки при запуске и импорте.

## Контекст
Проблемы сгруппированы по симптомам. Для углублённой диагностики смотрите логи.

## Шаги
1. Найдите симптом.
2. Проверьте список возможных причин.
3. Повторите запуск после исправлений.

## Ошибка валидации env
**Симптом:** приложение падает при старте с сообщением `Ошибка валидации env`.

**Что проверить:**
- Наличие всех обязательных переменных: `POSTGRES_HOST`, `POSTGRES_PORT`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`.
- Формат `ADDRESS_DATA_MONTH` (только `YYYYMM`, например `202501`).

## Ошибка подключения к PostgreSQL
**Симптом:** `/health/ready` возвращает `503`, либо приложение не стартует.

**Что проверить:**
- PostgreSQL доступен на `POSTGRES_HOST:POSTGRES_PORT`.
- В `docker-compose` используются те же значения, что в `.env`.
- Пользователь имеет права на подключение и создание расширений.

## Permission denied на `CREATE EXTENSION pg_trgm`
**Симптом:** импорт падает при создании расширения `pg_trgm`.

**Что проверить:**
- У пользователя PostgreSQL есть права на `CREATE EXTENSION`.
- При необходимости создайте расширение вручную под суперпользователем.

## Импорт не выполняется (advisory lock)
**Симптом:** CLI пишет `advisory lock not acquired -> skip`.

**Что проверить:**
- Импорт уже выполняется в другом процессе.
- После завершения повторите запуск.

## Импорт не скачивает архив или архив пустой
**Симптомы:**
- Ошибка загрузки или статус не 200.
- Сообщения `road_code_total*.txt not found in zip` или `build_*.txt not found in zip`.

**Что проверить:**
- Доступ к `https://business.juso.go.kr/api/jst/download`.
- Корректность `ADDRESS_DATA_MONTH` (возможно, за этот месяц архив ещё не опубликован).

## Shadow table is empty after import
**Симптом:** импорт завершился с ошибкой `Shadow table is empty after import.`

**Что проверить:**
- Корректность скачанного архива.
- Наличие данных в `build_*.txt`.
- Логи импорта на предмет ошибок парсинга.

## Нет данных в таблице
**Симптом:** `/addresses/search` возвращает пустой массив.

**Что проверить:**
- Импорт завершился успешно.
- В таблице `addresses` есть строки (`SELECT COUNT(*) FROM addresses`).
- Запрос использует валидный `query`.

## Ограничения
Документ покрывает типовые случаи и не заменяет анализ логов.

## См. также
- [Импорт адресов](../how-to/addresses-import.md)
- [Переменные окружения](../reference/configuration/environment-variables.md)
