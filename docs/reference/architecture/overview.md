<- [Содержание](../../README.md)

---

# Архитектура: обзор
Owner: Backend Team
Last reviewed: 2026-02-04

## Цель
Описать общую структуру сервиса, точки входа и основные потоки данных.

## Контекст
Сервис построен на NestJS и использует PostgreSQL. Есть два контекста: HTTP API и CLI импорт.

## Шаги
1. Ознакомьтесь с точками входа.
2. Посмотрите ключевые потоки (поиск и импорт).
3. Перейдите к деталям в связанных документах.

## Входные точки
1. **HTTP API** (`src/main.ts`)
- Поднимает NestJS приложение.
- Подключает глобальные пайпы, фильтры, интерсепторы и guard.
- Публикует Swagger UI на `/docs` при включённом `SWAGGER_ENABLED`.

2. **CLI импорт адресов** (`src/cli/addresses-import.main.ts`)
- Создаёт изолированный Nest-контекст без HTTP сервера.
- Запускает импорт данных в PostgreSQL.

## Основные потоки
**Поиск адресов**
- Контроллер принимает запрос `/addresses/search`.
- Сервис нормализует параметры и формирует условия поиска.
- Репозиторий выполняет запрос через TypeORM.
- Результат преобразуется в API-структуру.

**Импорт адресов**
- CLI скачивает архив с внешнего источника.
- Данные парсятся и вставляются батчами в `addresses_next`.
- После успешной загрузки таблицы переключаются атомарно.

## Слои и директории
- `src/modules/*` — доменные модули (контроллеры, сервисы, репозитории).
- `src/infrastructure/*` — инфраструктура (БД, логирование, mailer).
- `src/common/*` — общие утилиты, интерсепторы, фильтры.
- `src/cli/*` — CLI сценарии (импорт адресов).
- `src/config/*` — конфигурация и валидация окружения.

## Ограничения
Документ даёт обзор, но не содержит детальной карты модулей и жизненного цикла запроса.

## См. также
- [Архитектура: карта модулей](module-map.md)
- [Архитектура: жизненный цикл запроса](request-lifecycle.md)
- [Импорт адресов](../../how-to/addresses-import.md)
