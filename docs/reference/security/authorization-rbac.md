<- [Содержание](../../README.md)

---

# Безопасность: авторизация и RBAC
Owner: Security Team
Last reviewed: 2026-02-04

## Цель
Зафиксировать текущий статус авторизации и возможные точки расширения.

## Контекст
Авторизация и роли ещё не реализованы. Используется только проверка access-токена на отдельных эндпоинтах.

## Шаги
1. Ознакомьтесь с текущими границами доступа.
2. При внедрении RBAC обновите этот документ и API-эндпоинты.

## Текущее состояние
- Авторизация и RBAC не реализованы.
- Нет ролей, прав доступа и проверок на уровне контроллеров/сервисов.

## Текущие границы доступа
- Защищённые эндпоинты: `GET /auth/me`, `POST /auth/logout`.
- Защита реализована через `AccessTokenGuard` (JWT + проверка сессии).
- Все остальные эндпоинты публичны.

## Как подключать защиту
Используйте `AccessTokenGuard` на уровне контроллера или метода и извлекайте пользователя через `CurrentUser`.

Пример:

```ts
@UseGuards(AccessTokenGuard)
@Get('profile')
getProfile(@CurrentUser() user: AuthenticatedUser) {
  return this.usersService.getById(user.userId);
}
```

Что делает Guard:
- Проверяет `Authorization: Bearer <access_token>`.
- Валидирует JWT и сессию.
- Кладёт `{ userId, sessionId }` в `request.auth`.

## Точки расширения
Если потребуется контроль доступа:
- Добавьте роли и права в доменную модель.
- Реализуйте Guard или Policy layer.
- Определите матрицу прав доступа и отразите её в API-документации.

После внедрения RBAC обновите:
- [API: эндпоинты](../api/endpoints.md)
- [Безопасность: hardening](hardening.md)

## Ограничения
Документ не описывает конкретные роли — их пока нет в коде.

## См. также
- [Безопасность: аутентификация](authentication.md)
