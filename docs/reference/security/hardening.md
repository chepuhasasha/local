<- [Содержание](../../README.md)

---

# Безопасность: hardening
Owner: Security Team
Last reviewed: 2026-02-04

## Цель
Зафиксировать текущие меры защиты и то, что ещё не реализовано.

## Контекст
Документ описывает только текущие технические меры в коде.

## Шаги
1. Ознакомьтесь с тем, что уже внедрено.
2. Проверьте список отсутствующих мер.
3. Планируйте улучшения по мере необходимости.

## Текущее состояние
- **Валидация входных данных**: глобальный `ValidationPipe` с `whitelist`, `transform`, `forbidNonWhitelisted`.
- **Единый формат ошибок**: `HttpExceptionFilter` формирует JSON и логирует ошибки.
- **Request ID**: `RequestIdInterceptor` добавляет `x-request-id` и сохраняет его в контексте.
- **Валидация конфигурации**: все env-переменные проходят проверку Zod.
- **OTP лимиты**: cooldown и окно для `/auth/email/start` на уровне сервиса.
- **Rate limiting**: глобальный throttling для всех эндпоинтов и отдельные лимиты для `/auth/email/start`, `/auth/email/verify`, `/auth/refresh`.
- **Swagger в production**: UI отключён по умолчанию, включается через `SWAGGER_ENABLED=true`.
- **Защитные HTTP заголовки**: `X-Content-Type-Options`, `X-Frame-Options`, `Referrer-Policy`, CSP.
- **CORS**: явный allowlist для origins/методов через env.
- **Лимиты размера тела**: ограничения для JSON и urlencoded body.

## Аудит зависимостей
Последний запуск: **2026-02-04**.

Результат:
- `npm audit`: 0 уязвимостей.
- Обновлено: `nodemailer` до `7.0.13`.
- Overrides: `lodash` до `4.17.23`, `@isaacs/brace-expansion` до `5.0.1`.

## Что отсутствует
- Полное покрытие аутентификацией и авторизацией для всех эндпоинтов.
- Политика работы с секретами (vault, KMS и т.п.).

## Рекомендации
1. Добавить аутентификацию и минимум базовых ролей.
2. Пересмотреть и тюнить лимиты rate limiting под реальную нагрузку.
3. Периодически пересматривать allowlist CORS и CSP под реальные источники трафика.
4. Тюнить лимиты размера тела запросов под продуктовые сценарии.
5. Зафиксировать политику хранения и ротации секретов.

## Ограничения
Документ не является чек-листом безопасности для продакшна.

## См. также
- [Архитектура: жизненный цикл запроса](../architecture/request-lifecycle.md)
- [Безопасность: аутентификация](authentication.md)
