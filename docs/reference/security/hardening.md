<- [Содержание](../../README.md)

---

# Безопасность: hardening
Owner: Security Team
Last reviewed: 2026-02-04

## Цель
Зафиксировать текущие меры защиты и то, что ещё не реализовано.

## Контекст
Документ описывает только текущие технические меры в коде.

## Шаги
1. Ознакомьтесь с тем, что уже внедрено.
2. Проверьте список отсутствующих мер.
3. Планируйте улучшения по мере необходимости.

## Текущее состояние
- **Валидация входных данных**: глобальный `ValidationPipe` с `whitelist`, `transform`, `forbidNonWhitelisted`.
- **Единый формат ошибок**: `HttpExceptionFilter` формирует JSON и логирует ошибки.
- **Request ID**: `RequestIdInterceptor` добавляет `x-request-id` и сохраняет его в контексте.
- **Валидация конфигурации**: все env-переменные проходят проверку Zod.
- **OTP лимиты**: cooldown и окно для `/auth/email/start` на уровне сервиса.
- **Rate limiting**: глобальный throttling для всех эндпоинтов и отдельные лимиты для `/auth/email/start`, `/auth/email/verify`, `/auth/refresh`.
- **Swagger в production**: UI отключён по умолчанию, включается через `SWAGGER_ENABLED=true`.

## Что отсутствует
- Полное покрытие аутентификацией и авторизацией для всех эндпоинтов.
- Защитные HTTP заголовки (например, `helmet`).
- Явная настройка CORS.
- Ограничения на размер тела запроса.
- Политика работы с секретами (vault, KMS и т.п.).

## Рекомендации
1. Добавить аутентификацию и минимум базовых ролей.
2. Пересмотреть и тюнить лимиты rate limiting под реальную нагрузку.
3. Настроить CORS и защитные заголовки.
4. Ввести лимиты на размер запросов для защиты от злоупотреблений.
5. Зафиксировать политику хранения и ротации секретов.

## Ограничения
Документ не является чек-листом безопасности для продакшна.

## См. также
- [Архитектура: жизненный цикл запроса](../architecture/request-lifecycle.md)
- [Безопасность: аутентификация](authentication.md)
