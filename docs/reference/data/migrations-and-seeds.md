<- [Содержание](../../README.md)

---

# Данные: миграции и сиды
Owner: Backend Team
Last reviewed: 2026-02-04

## Цель
Описать, как управляются миграции и наполнение базы.

## Контекст
Доменные таблицы создаются миграциями, адресные — импортом.

## Шаги
1. Запустите миграции доменных таблиц.
2. Запустите импорт адресов.

## Текущее состояние
- Добавлены миграции для доменных таблиц (`users`, `auth_identity` с `password_hash`, `auth_otp`, `auth_session`).
- Таблицы адресов создаются процессом CLI импорта.
- `TypeORM` ищет миграции в `src/infrastructure/database/migrations` и `dist/infrastructure/database/migrations`.

## Как инициализировать базу
1. Запустите миграции доменных таблиц:

```bash
npm run migration:run
```

2. Выполните импорт адресов (создаёт таблицы и индексы для адресов):

```bash
npm run import:addresses:dev
```

Импорт сам создаёт таблицы, индексы и расширения. Подробнее — в [Импорт адресов](../../how-to/addresses-import.md).

## Если понадобятся миграции
1. Определите стратегию: что должно делаться импортом, а что — миграциями.
2. Добавьте миграции и скрипты их запуска в `package.json`.
3. Зафиксируйте процесс в документации.

## Ограничения
Схема адресов всё ещё живёт в коде импорта, доменные таблицы — в миграциях.

## См. также
- [Импорт адресов](../../how-to/addresses-import.md)
- [Конфигурация](../configuration/environment-variables.md)
